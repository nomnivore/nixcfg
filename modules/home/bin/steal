# Converts a symlink of a file to a copy of that file
# with user-write permissions.

set -euo pipefail

if [ $# -eq 0 ]; then
  echo "Usage: $0 <file-path>..."
  exit 1
fi

for file in "$@"; do
  if [ ! -e "$file" ]; then
    echo "Error: '$file' is not a valid file path." >&2
    continue
  fi
  # convert the symlink to a copy of the file
  cp --remove-destination "$(readlink -f "$file")" "$file"
  # set permissions because nix store is readonly
  chmod u+w "$file"
done
