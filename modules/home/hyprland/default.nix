# A collection of modules/configurations for a hyprland-based desktop environment

{
  pkgs,
  osConfig,
  config,
  lib,
  ...
}:

let
  cfg = config.modules.hyprland;

  # master toggle
  enable = osConfig.modules.hyprland.enable;
in

with lib;
{
  options.modules.hyprland = {

  };
  imports =
    [ ]
    # conditional imports
    ++ (optionals (enable) [
      ./lookandfeel.nix
      ./bindings
      ./waybar
      ./hyprpaper.nix # wallpaper
    ]);
  config = mkIf osConfig.modules.hyprland.enable {

    # some default apps referenced in config
    programs.foot.enable = true;

    services.mako.enable = true; # automatically styled by stylix

    programs.rofi = {
      enable = true;
      package = pkgs.rofi-wayland;
    };

    wayland.windowManager.hyprland = {
      enable = true;

      # avoid conflict with uwsm setup
      systemd.enable = false;

      # basic config just to get things started
      # mostly taken from the autogenerated config

      settings = {

        # MONITORS
        monitor = ",preferred,auto,auto";

        # MY PROGRAMS
        # TODO: manage this better
        "$terminal" = "foot";
        # "$fileManager" = "dolphin";
        "$menu" = "rofi -terminal=$terminal -show drun";

        # AUTOSTART
        exec-once = [
          # TODO:
        ];

        # ENVIRONMENT VARIABLES
        env = [
          "XCURSOR_SIZE,24"
          "HYPRCURSOR_SIZE,24"
        ];

      };
    };

  };
}
